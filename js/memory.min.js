var bootState={create:function(){game.physics.startSystem(Phaser.Physics.ARCADE),game.state.start('load')}},loadState={preload:function(){firstRunLandscape=game.scale.isGameLandscape,game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.refresh(),game.scale.forceOrientation(!1,!0),game.scale.enterIncorrectOrientation.add(handleIncorrect),game.scale.leaveIncorrectOrientation.add(handleCorrect);var b=game.add.text(game.world.centerX,game.world.centerY,'loading...',{font:'56px Open Sans',fill:'#fff'});b.anchor.set(0.5),b.scale.set(config.scale_ratio*game.device.pixelRatio),game.load.atlasJSONHash('cards','sprites/output.png','sprites/output.json'),game.load.text('cache','data/memory.json')},create:function(){cards=JSON.parse(game.cache.getText('cache')),game.state.start('menu')}};function handleIncorrect(){game.device.desktop||(document.getElementById('turn').style.display='block',document.getElementById('gameDiv').style.display='none')}function handleCorrect(){game.device.desktop||(firstRunLandscape&&(game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.setMaximum(),game.scale.setScreenSize(!0),game.state.start('play')),document.getElementById('turn').style.display='none',document.getElementById('gameDiv').style.display='block')}var menuState={create:function(){var b=3<=game.device.pixelRatio?2:Math.trunc(game.device.pixelRatio);$('meta[name=\'theme-color\']').attr('content','#f47d44'),console.log(b);var c=this.game.add.bitmapData(this.game.width,this.game.height),d=c.context.createLinearGradient(0,0,0,500);d.addColorStop(0,'#f47d44'),d.addColorStop(1,'#e46764'),c.context.fillStyle=d,c.context.fillRect(0,0,this.game.width,this.game.height);var e=this.game.add.sprite(0,0,c);e.alpha=0,this.game.add.tween(e).to({alpha:1},1e3).start();var f=game.add.sprite(game.world.centerX,game.world.centerY/1.5,'cards','logo-bw');f.anchor.set(0.5),f.scale.setTo(config.scale_ratio*b),f.alpha=0;game.world.width/game.world.height;this.guideLabel=game.add.text(f.x,f.y+400*config.scale_ratio,dictionary[cur_lang]._guide_l,{font:'76px Open Sans',fill:'#000',align:'center'}),this.guideLabel.anchor.set(0.5),this.guideLabel.scale.set(config.scale_ratio*b),this.guideLabel.alpha=0,this.guideLabel.inputEnabled=!0;var h=game.add.text(f.x-50*b,this.guideLabel.y+300*config.scale_ratio,'en',{font:'76px Open Sans',fill:'#000'});h.anchor.set(0.5),h.scale.set(config.scale_ratio*b),h.alpha=0,h.inputEnabled=!0,h.lang='en';var l=game.add.text(h.x+50*b,h.y,'/',{font:'76px Open Sans',fill:'#000'});l.anchor.set(0.5),l.scale.setTo(config.scale_ratio*b),l.alpha=0;var m=game.add.text(l.x+50*b,h.y,'ru',{font:'76px Open Sans',fill:'#000'});m.anchor.set(0.5),m.scale.setTo(config.scale_ratio*b),m.alpha=0,m.lang='ru',m.inputEnabled=!0,this.startLabel=game.add.text(f.x,h.y+200*config.scale_ratio,'\u0421\u0422\u0410\u0420\u0422',{font:'76px Open Sans',fill:'#000',align:'center'}),this.startLabel.anchor.set(0.5),this.startLabel.scale.setTo(config.scale_ratio*b),this.startLabel.alpha=0,this.startLabel.inputEnabled=!0,h.events.onInputDown.add(this.switchLang,this,0),m.events.onInputDown.add(this.switchLang,this,0),this.startLabel.events.onInputDown.add(this.start,this),this.guideLabel.events.onInputDown.add(this.showGuide,this),game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(this.start,this),game.add.tween(f).to({alpha:0.7},1500,'Linear',!0),game.add.tween(h).to({alpha:0.7},1500,'Linear',!0),game.add.tween(l).to({alpha:0.7},1500,'Linear',!0),game.add.tween(m).to({alpha:0.7},1500,'Linear',!0),game.add.tween(this.startLabel).to({alpha:0.7},1500,'Linear',!0),game.add.tween(this.guideLabel).to({alpha:0.7},1500,'Linear',!0)},start:function(){game.state.start('play')},showGuide:function(){$('.guide').fadeIn(300),$('#guide_close').click(function(){$('.guide').hide()}),$('#guide_heading').text(dictionary[cur_lang]._guide_l),$('#guide_desc').html(dictionary[cur_lang]._guide)},switchLang:function(b){cur_lang=b.lang,this.startLabel.setText(dictionary[cur_lang]._start),this.guideLabel.setText(dictionary[cur_lang]._guide_l)}},playState={create:function(){$('meta[name=\'theme-color\']').attr('content','#9eccb3');var b=this.game.add.bitmapData(this.game.width,this.game.height),c=b.context.createLinearGradient(0,0,0,500);c.addColorStop(0,'#9eccb3'),c.addColorStop(1,'#83b5dd'),b.context.fillStyle=c,b.context.fillRect(0,0,this.game.width,this.game.height);var d=this.game.add.sprite(0,0,b);d.alpha=0,this.game.add.tween(d).to({alpha:1},1e3).start(),this.linesCanvasGraphic=game.add.graphics(0,0),this.squareList=[],this.openedCards=[],this.timer=game.time.create(),this.countDownSeconds=0,this.cards=game.add.group(),this.cards.enableBody=!0,this.cards.physicsBodyType=Phaser.Physics.ARCADE,this.cards.inputEnableChildren=!0,this.generateTiles(),this.cards.onChildInputDown.add(this.flipCard,this),this.timer.start()},randomizeTiles:function(){for(var c,b=[];15>b.length;)c=Math.floor(16*Math.random()),-1<b.indexOf(c)||(b[b.length]=c);for(var d=0;d<b.length;d++)this.squareList.push(b[d]),this.squareList.push(b[d]);var e,f,g;for(g=this.squareList.length-1;0<g;g--)e=Math.floor(Math.random()*(g+1)),f=this.squareList[g],this.squareList[g]=this.squareList[e],this.squareList[e]=f},generateTiles:function(){this.randomizeTiles(),this.cards.createMultiple(30,'cards','hserun_card',!0),this.cards.children.forEach(function(f,g){f.scale.setTo(config.scale_ratio),f.mainFrame=cards[this.squareList[g]].frame,f.id=this.squareList[g]},this);var b=-1,c=-1;if(game.device.desktop)this.cards.align(-1,6,512*config.scale_ratio+10,512*config.scale_ratio+10,Phaser.CENTER),this.cards.scale.setTo(config.scale_ratio),b=(game.world.width-(2560*Math.pow(config.scale_ratio,2)+40))/2,c=config.scale_ratio*game.world.centerY;else{if(b=(game.world.width-(2560*config.scale_ratio+40))/2,this.cards.align(-1,6,512*config.scale_ratio+10,512*config.scale_ratio+10,Phaser.LEFT_CENTER),0>b){var d=game.world.width/(2560*config.scale_ratio+60);this.cards.scale.setTo(d),b=(game.world.width-this.cards.width)/2}c=0.3*game.world.centerY}this.cards.position=new Phaser.Point(b,c);var e=3<=3*game.device.pixelRatio?2:Math.trunc(game.device.pixelRatio);this.timeLabel=game.add.text(game.world.centerX,c-200*config.scale_ratio,'120',{font:'120px Open Sans',fill:'#000'}),this.timeLabel.scale.setTo(config.scale_ratio*e),this.timeLabel.anchor.set(0.5)},countDownTimer:function(){this.timeLimit=150;var b=this.timer.seconds;this.countDownSeconds=this.timeLimit-b,this.timeLabel.setText(Math.floor(this.countDownSeconds)),0>=this.countDownSeconds&&(this.countDownSeconds=0,this.timeLabel.setText(this.countDownSeconds),this.Lose())},update:function(){this.countDownTimer(),0===this.cards.children.length&&0!==this.countDownSeconds&&this.Win()},tween:function(b){var c=game.add.tween(b.scale);c.to({x:0},300,Phaser.Easing.Linear.None,!1,0),c.onComplete.addOnce(function(){b.frameName='hserun_card'===b.frameName?b.mainFrame:'hserun_card'},this);var d=game.add.tween(b.scale);d.to({x:b.scale.x},300,Phaser.Easing.Linear.None,!1,0),c.chain(d),c.start()},flipCard:function(b){if(!b.clicked&&2>this.openedCards.length&&(b.clicked=!0,this.openedCards.push(b),this.tween(b),2===this.openedCards.length)){console.log(this.openedCards);game.time.events.add(Phaser.Timer.SECOND,function(){if(this.openedCards[0].mainFrame===this.openedCards[1].mainFrame){this.timer.pause(),this.cards.remove(this.openedCards[0],!0),this.cards.remove(this.openedCards[1],!0),$('#popup_close').click(function(){this.timer.resume(),$('.popup').hide()}.bind(this));var d=$(document.createElement('img'));d.attr('src','//hserun.ru/memory/img/'+cards[this.openedCards[0].id].frame+'.png'),d.attr('class','cover'),$('#popup_heading').text(cards[this.openedCards[0].id].name[cur_lang]),$('#popup_desc').text(cards[this.openedCards[0].id].fact[cur_lang]),$('#popup_desc').prepend(d),$('.popup').fadeIn(300)}else{var e=this.cards.getChildAt(this.cards.getChildIndex(this.openedCards[0])),f=this.cards.getChildAt(this.cards.getChildIndex(this.openedCards[1]));this.tween(e),this.tween(f),e.clicked=!1,f.clicked=!1}this.openedCards=[]},this)}},Win:function(){upSeconds=this.timeLimit-this.countDownSeconds,game.state.start('win')},Lose:function(){game.state.start('lose')}},winState={create:function(){$('meta[name=\'theme-color\']').attr('content','#a746db');var b=this.game.add.bitmapData(this.game.width,this.game.height),c=b.context.createLinearGradient(0,0,this.game.width,this.game.height);c.addColorStop(0,'#a746db'),c.addColorStop(1,'#547ac6'),b.context.fillStyle=c,b.context.fillRect(0,0,this.game.width,this.game.height);var d=this.game.add.sprite(0,0,b);d.alpha=0,this.game.add.tween(d).to({alpha:1},2e3).start();var e=3<=game.device.pixelRatio?2:Math.trunc(game.device.pixelRatio);console.log(e);var f=game.add.sprite(game.world.centerX,game.world.centerY/1.5,'cards','logo-w');f.anchor.set(0.5),f.scale.setTo(config.scale_ratio*e),f.alpha=0;var g=game.add.text(f.x,f.y+350*config.scale_ratio,dictionary[cur_lang]._time_is.toString().format(Math.round(upSeconds)),{font:'84px Open Sans',fill:'#fff',align:'center'});g.anchor.set(0.5),g.scale.setTo(config.scale_ratio*e),g.alpha=0;var h=game.add.text(g.x,g.y+300*config.scale_ratio,dictionary[cur_lang]._play_once_more,{font:'76px Open Sans',fill:'#fff',align:'center'});h.anchor.set(0.5),h.inputEnabled=!0,h.scale.setTo(config.scale_ratio*e),h.alpha=0,h.events.onInputDown.add(this.restart,this),game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(this.restart,this),game.add.tween(f).to({alpha:1},1500,'Linear',!0),game.add.tween(h).to({alpha:1},1500,'Linear',!0),game.add.tween(g).to({alpha:1},1500,'Linear',!0)},restart:function(){game.state.start('play')}},loseState={create:function(){var b=3<=game.device.pixelRatio?2:Math.trunc(game.device.pixelRatio);console.log(b),$('meta[name=\'theme-color\']').attr('content','#a746db');var c=this.game.add.bitmapData(this.game.width,this.game.height),d=c.context.createLinearGradient(0,0,this.game.width,this.game.height);d.addColorStop(0,'#a746db'),d.addColorStop(1,'#547ac6'),c.context.fillStyle=d,c.context.fillRect(0,0,this.game.width,this.game.height);var e=this.game.add.sprite(0,0,c);e.alpha=0,this.game.add.tween(e).to({alpha:1},2e3).start();var f=game.add.sprite(game.world.centerX,game.world.centerY/1.5,'cards','logo-w');f.anchor.set(0.5),f.scale.setTo(config.scale_ratio*b),f.alpha=0;var g=game.add.text(f.x,f.y+350*config.scale_ratio,dictionary[cur_lang]._time_out,{font:'76px Open Sans',fill:'#fff',align:'center'});g.anchor.set(0.5),g.scale.setTo(config.scale_ratio*b),g.alpha=0;var h=game.add.text(g.x,g.y+200*config.scale_ratio,dictionary[cur_lang]._try_again,{font:'54px Open Sans',fill:'#fff',align:'center'});h.anchor.set(0.5),h.scale.setTo(config.scale_ratio*b),h.alpha=0,h.inputEnabled=!0,h.events.onInputDown.add(this.restart,this),game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(this.restart,this),game.add.tween(f).to({alpha:1},1500,'Linear',!0),game.add.tween(g).to({alpha:1},1500,'Linear',!0),game.add.tween(h).to({alpha:1},1500,'Linear',!0)},restart:function(){game.state.start('play')}},config={canvas_width_max:4096,canvas_width:650,canvas_height_max:4096,canvas_height:650,scale_ratio:1,aspect_ratio:1};config.canvas_width=window.innerWidth*window.devicePixelRatio,config.canvas_height=window.innerHeight*window.devicePixelRatio,config.aspect_ratio=config.canvas_width/config.canvas_height,config.scale_ratio=1>config.aspect_ratio?config.canvas_height/config.canvas_height_max:config.canvas_width/config.canvas_width_max;var game=new Phaser.Game(config.canvas_width,config.canvas_height,Phaser.CANVAS,'gameDiv'),firstRunLandscape,upSeconds=0,cards,cur_lang='ru';String.prototype.format=function(){var b=[].slice.call(arguments);return this.replace(/(\{\d+\})/g,function(c){return b[+c.substr(1,c.length-2)||0]})};var dictionary={ru:{_start:'\u0421\u0422\u0410\u0420\u0422',_time_out:'\u0412\u0440\u0435\u043C\u044F \u0432\u044B\u0448\u043B\u043E',_try_again:'\u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439 \u0435\u0449\u0435 \u0440\u0430\u0437',_time_is:'\u041F\u0440\u043E\u0439\u0434\u0435\u043D\u043E \u0437\u0430 {0} \u0441\u0435\u043A.',_play_once_more:'\u041F\u0440\u043E\u0439\u0442\u0438 \u0435\u0449\u0435 \u0440\u0430\u0437',_share:'\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F',_guide:'<p>\u041A\u0442\u043E \u0432 \u0434\u0435\u0442\u0441\u0442\u0432\u0435 \u043D\u0435 \u0438\u0433\u0440\u0430\u043B \u0445\u043E\u0442\u044F \u0431\u044B \u0440\u0430\u0437 \u0432 <b>\xAB\u041C\u0435\u043C\u043E\u0440\u0438\xBB</b>?</p><p><b>HSE RUN</b> \u043F\u0440\u0435\u0434\u043B\u0430\u0433\u0430\u0435\u0442 \u0432\u0441\u043F\u043E\u043C\u043D\u0438\u0442\u044C \u044E\u043D\u044B\u0435 \u0433\u043E\u0434\u044B \u0438 \u043F\u043E\u0442\u0440\u0435\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u0430\u043C\u044F\u0442\u044C, \u0430 \u0437\u0430\u043E\u0434\u043D\u043E \u0438 \u0443\u0437\u043D\u0430\u0442\u044C \u041C\u043E\u0441\u043A\u0432\u0443 \u043D\u0435\u043C\u043D\u043E\u0433\u043E \u043B\u0443\u0447\u0448\u0435</p><p><b>\u041F\u0440\u0430\u0432\u0438\u043B\u0430 \u0438\u0433\u0440\u044B:</b></p><p><b>\u0428\u0430\u0433 1.</b> \u041F\u0435\u0440\u0435\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u0442\u0435 \u0434\u0432\u0435 \u043B\u044E\u0431\u044B\u0435 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438 \u0438 \u0437\u0430\u043F\u043E\u043C\u0438\u043D\u0430\u0435\u0442\u0435 \u043B\u043E\u043A\u0430\u0446\u0438\u0438 \u041C\u043E\u0441\u043A\u0432\u044B, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u043D\u0430 \u043D\u0438\u0445 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u044B</p><p><b>\u0428\u0430\u0433 2.</b> \u041A\u0430\u0440\u0442\u043E\u0447\u043A\u0438 \u0438\u0441\u0447\u0435\u0437\u0430\u044E\u0442 \u0441 \u043F\u043E\u043B\u044F, \u043A\u043E\u0433\u0434\u0430 \u0432\u044B \u043F\u0435\u0440\u0435\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u0442\u0435\n \u0434\u0432\u0435 \u043E\u0434\u0438\u043D\u0430\u043A\u043E\u0432\u044B\u0435 \u0437\u0430 \u043E\u0434\u0438\u043D \u0445\u043E\u0434</p><p><b>\u0428\u0430\u0433 3.</b> \u0417\u0430\u0434\u0430\u0447\u0430 \u2013 \u0443\u0431\u0440\u0430\u0442\u044C \u0441 \u043F\u043E\u043B\u044F \u0432\u0441\u0435 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438 \u0437\u0430 150 \u0441\u0435\u043A\u0443\u043D\u0434</p>',_guide_l:'\u041A\u0430\u043A \u0438\u0433\u0440\u0430\u0442\u044C?'},en:{_start:'START',_time_out:'Time is out',_try_again:'Try again',_time_is:'Your time is {0}s',_play_once_more:'Play again',_share:'Share',_guide:'<p>We bet you enjoyed playing <b>\xABMemory\xBB</b> in your childhood!</p><p><b>HSE RUN</b> gives you a chance to go back to those days, train you brain and learn some interesting facts about Moscow</p><p><b>How to play:</b></p><p><b>Step 1.</b> Turn over two random cards and memorize places in Moscow that are depicted on them</p><p><b>Step 2.</b> The moment you turn over two identical cards they flip away</p><p><b>Step 3.</b> The main goal is to remove all the cards for 2,5 minutes</p>',_guide_l:'How to play?'}};game.state.add('boot',bootState),game.state.add('load',loadState),game.state.add('menu',menuState),game.state.add('play',playState),game.state.add('win',winState),game.state.add('lose',loseState),game.state.start('boot');